local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local UIS = game:GetService("UserInputService")

local player = Players.LocalPlayer
local function setupWallhop(character)
	local humanoid = character:WaitForChild("Humanoid")
	local hrp = character:WaitForChild("HumanoidRootPart")
	local camera = workspace.CurrentCamera

	-- GUI
	local screenGui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	screenGui.Name = "WallhopGUI"
	screenGui.ResetOnSpawn = false

	local toggleBtn = Instance.new("TextButton")
	toggleBtn.Size = UDim2.new(0, 120, 0, 50)
	toggleBtn.Position = UDim2.new(0, 10, 1, -60)
	toggleBtn.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
	toggleBtn.TextColor3 = Color3.new(1, 1, 1)
	toggleBtn.Font = Enum.Font.GothamBold
	toggleBtn.TextScaled = true
	toggleBtn.Text = "Wallhop: OFF"
	toggleBtn.Parent = screenGui
	toggleBtn.Active = true
	toggleBtn.Draggable = true

	local wallhopEnabled = false
	local isWallhopping = false

	toggleBtn.MouseButton1Click:Connect(function()
		wallhopEnabled = not wallhopEnabled
		toggleBtn.Text = wallhopEnabled and "Wallhop: ON" or "Wallhop: OFF"
	end)

	local function isBetweenTwoParts()
		local origin = hrp.Position - Vector3.new(0, 2.5, 0)
		local directions = {
			Vector3.new(1, 0, 0),
			Vector3.new(-1, 0, 0),
			Vector3.new(0, 0, 1),
			Vector3.new(0, 0, -1),
		}

		local hits = {}

		for _, dir in pairs(directions) do
			local result = workspace:Raycast(origin, dir * 2, RaycastParams.new())
			if result then
				table.insert(hits, result.Instance)
			end
		end

		if #hits >= 2 and hits[1] ~= hits[2] then
			local dist = (hits[1].Position - hits[2].Position).Magnitude
			return dist <= 4
		end

		return false
	end

	local function rotateCameraInstant(deg)
		local cf = camera.CFrame
		camera.CFrame = cf * CFrame.Angles(0, math.rad(deg), 0)
	end

	RunService.Heartbeat:Connect(function()
		if not wallhopEnabled or isWallhopping then return end

		if isBetweenTwoParts() and humanoid.FloorMaterial == Enum.Material.Air then
			isWallhopping = true

			-- Lompat tidak terlalu tinggi
			hrp.Velocity = Vector3.new(0, 35, 0)

			-- Kamera berputar instan
			rotateCameraInstant(90)

			task.wait(0.1)
			isWallhopping = false
		end
	end)
end

-- Setup awal dan saat respawn
local function connectChar(char)
	setupWallhop(char)
end

if player.Character then
	connectChar(player.Character)
end

player.CharacterAdded:Connect(connectChar)
