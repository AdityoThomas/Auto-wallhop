local Players = game:GetService("Players")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local camera = workspace.CurrentCamera

local function setupWallhop(character)
	local humanoid = character:WaitForChild("Humanoid")
	local root = character:WaitForChild("HumanoidRootPart")

	local gui = Instance.new("ScreenGui", player:WaitForChild("PlayerGui"))
	gui.Name = "WallhopGui"
	gui.ResetOnSpawn = false

	local toggle = Instance.new("TextButton")
	toggle.Size = UDim2.new(0, 140, 0, 50)
	toggle.Position = UDim2.new(0, 20, 1, -80)
	toggle.BackgroundColor3 = Color3.fromRGB(40, 40, 40)
	toggle.TextColor3 = Color3.new(1, 1, 1)
	toggle.Font = Enum.Font.GothamBold
	toggle.TextScaled = true
	toggle.Text = "Wallhop: OFF"
	toggle.Active = true
	toggle.Draggable = true
	toggle.Parent = gui

	local wallhopOn = false
	local hopping = false

	toggle.MouseButton1Click:Connect(function()
		wallhopOn = not wallhopOn
		toggle.Text = wallhopOn and "Wallhop: ON" or "Wallhop: OFF"
	end)

	local function rotateCamInstant(degrees)
		local cf = camera.CFrame
		camera.CFrame = cf * CFrame.Angles(0, math.rad(degrees), 0)
	end

	RunService.Heartbeat:Connect(function()
		if not wallhopOn or hopping then return end
		if humanoid:GetState() ~= Enum.HumanoidStateType.Freefall then return end

		-- Dua raycast ke bawah dari kiri dan kanan kaki
		local offset = 1.2
		local leftOrigin = root.Position + root.CFrame.RightVector * -offset
		local rightOrigin = root.Position + root.CFrame.RightVector * offset
		local direction = Vector3.new(0, -3, 0)

		local params = RaycastParams.new()
		params.FilterDescendantsInstances = {character}
		params.FilterType = Enum.RaycastFilterType.Blacklist

		local leftResult = workspace:Raycast(leftOrigin, direction, params)
		local rightResult = workspace:Raycast(rightOrigin, direction, params)

		if leftResult and rightResult and leftResult.Instance ~= rightResult.Instance then
			local dist = (leftResult.Position - rightResult.Position).Magnitude
			if dist <= 0.5 then
				hopping = true
				humanoid:ChangeState(Enum.HumanoidStateType.Jumping)
				rotateCamInstant(90)
				task.wait(0.1)
				hopping = false
			end
		end
	end)
end

-- Inisialisasi awal dan saat respawn
local function onCharacterAdded(character)
	setupWallhop(character)
end

if player.Character then
	onCharacterAdded(player.Character)
end
player.CharacterAdded:Connect(onCharacterAdded)
